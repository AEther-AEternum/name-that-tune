var nameDthatDtune=(()=>{var e,s=Object.create,r=Object.defineProperty,n=Object.getOwnPropertyDescriptor,o=Object.getOwnPropertyNames,i=Object.getPrototypeOf,l=Object.prototype.hasOwnProperty,t=(e=>"undefined"!=typeof require?require:"undefined"!=typeof Proxy?new Proxy(e,{get:(e,t)=>("undefined"!=typeof require?require:e)[t]}):e)(function(e){if("react"===e)return Spicetify.React;if("react-dom"===e)return Spicetify.ReactDOM;if("undefined"!=typeof require)return require.apply(this,arguments);throw new Error('Dynamic require of "'+e+'" is not supported')}),c=(t,a,s,i)=>{if(a&&"object"==typeof a||"function"==typeof a)for(let e of o(a))l.call(t,e)||e===s||r(t,e,{get:()=>a[e],enumerable:!(i=n(a,e))||i.enumerable});return t},a=(e,t,a)=>(a=null!=e?s(i(e)):{},c(!t&&e&&e.__esModule?a:r(a,"default",{value:e,enumerable:!0}),e)),u={},p=u,y={default:()=>function(){return F.default.createElement(G,null)}};for(e in y)r(p,e,{get:y[e],enumerable:!0});var f="app-module__container___thHYo_nameDthatDtune",d="app-module__title___jzQAy_nameDthatDtune",m="app-module__subtitle___eYtbK_nameDthatDtune",h="app-module__input___e4A54_nameDthatDtune",g="app-module__guessList___F8WJL_nameDthatDtune",S="app-module__formButtonContainer___xNdkD_nameDthatDtune",_=a(t("react")),P=a(t("react")),v="app-module__correct___z816V_nameDthatDtune",b=e=>{var t=e.won&&e.index===e.guesses.length-1;return P.default.createElement("li",{className:t?v:void 0},t?"âœ”":"x"," ",e.guesses[e.index]||"SKIPPED")},k=a(t("react")),w="button-module__button___qU0Jx_nameDthatDtune",E="button-module__circle___1vkh9_nameDthatDtune",D=e=>{var t=e.type||"round";const a=[w];return"circle"===t&&a.push(E),e.classes&&a.push(...e.classes),k.default.createElement("button",{className:a.join(" "),onClick:e.onClick,"aria-label":e.label,disabled:e.disabled},e.children)};var A=async e=>{const t=await Spicetify.CosmosAsync.get(`sp://core-playlist/v1/playlist/${e}/rows`,{policy:{link:!0}});return t.rows.map(e=>e.link)},I=(e,t)=>{for(const s of e)if("folder"===s.type&&null!=s.rows){if(s.link===t)return s;var a=I(s.rows,t);if(a)return a}},C=async e=>{var t=await Spicetify.CosmosAsync.get("sp://core-playlist/v1/rootlist",{policy:{folder:{rows:!0,link:!0}}}),t=I(t.rows,e);if(null==t)throw"Cannot find folder";let a=[];const s=e=>{if(e.rows)for(const t of e.rows)"playlist"===t.type?a.push(A(t.link)):"folder"===t.type&&s(t)};return s(t),(await Promise.all(a)).flat()},T=async()=>{const e=await Spicetify.CosmosAsync.get("sp://core-collection/unstable/@/list/tracks/all?responseFormat=protobufJson",{policy:{list:{link:!0}}});return e.item.map(e=>e.trackMetadata.link)},U=async e=>{e=e.split(":")[2];const t=await Spicetify.CosmosAsync.get("https://api.spotify.com/v1/albums/"+e);return t.tracks.items.map(e=>e.uri)},N=async e=>{const t=await Spicetify.CosmosAsync.get(`sp://core-show/v1/shows/${e}?responseFormat=protobufJson`),a=t.items.filter(e=>e.episodePlayState.isPlayable);return a.map(e=>e.episodeMetadata.link)},q=async e=>{const t=await Spicetify.CosmosAsync.get(`https://api-partner.spotify.com/pathfinder/v1/query?operationName=queryArtistOverview&variables=%7B%22uri%22%3A%22${e}%22%7D&extensions=%7B%22persistedQuery%22%3A%7B%22version%22%3A1%2C%22sha256Hash%22%3A%22433e28d1e949372d3ca3aa6c47975cff428b5dc37b12f5325d9213accadf770a%22%7D%7D`);return t.data.artist.discography.topTracks.items.map(e=>e.track.uri)};function R(e){let t=e.length;if(t<=1)return e;for(var a=e[0];0<t;){var s=Math.floor(Math.random()*t),i=e[--t];e[t]=e[s],e[s]=i}for(;e[0]===a;)e=R(e);return e}var L=e=>`Shuffled ${e} items!`;async function M(e,t){var a;if("playedstation"!==e[0]){var s=e.length;if(0===s)throw"There is no available track to play";if(1===s)Spicetify.Platform.PlayerAPI.play({uri:e[0]},{featureVersion:Spicetify.Platform.PlayerAPI._defaultFeatureVersion});else{e.push("spotify:delimiter"),Spicetify.Platform.PlayerAPI.clearQueue();const i=!t;await Spicetify.CosmosAsync.put("sp://player/v2/main/queue",{queue_revision:null==(a=Spicetify.Queue)?void 0:a.queueRevision,next_tracks:e.map(e=>({uri:e,provider:i?"queue":"context",metadata:{is_queued:i}})),prev_tracks:null==(a=Spicetify.Queue)?void 0:a.prevTracks}),i||await Spicetify.CosmosAsync.post("sp://player/v2/main/update",{context:{uri:t,url:"context://"+t}}),Spicetify.showNotification(L(s))}}}function B(t){!async function(e){const t=Spicetify.URI.fromString(e);switch(t.type){case Spicetify.URI.Type.SHOW:return N(t.getBase62Id());case Spicetify.URI.Type.PLAYLIST:case Spicetify.URI.Type.PLAYLIST_V2:return A(e);case Spicetify.URI.Type.FOLDER:return C(e);case Spicetify.URI.Type.ALBUM:return U(e);case Spicetify.URI.Type.COLLECTION:return T();case Spicetify.URI.Type.ARTIST:return q(e);case Spicetify.URI.Type.TRACK:case Spicetify.URI.Type.EPISODE:return[e];case Spicetify.URI.Type.STATION:case Spicetify.URI.Type.RADIO:return Spicetify.Platform.PlayerAPI.play({uri:e},{featureVersion:Spicetify.Platform.PlayerAPI._defaultFeatureVersion}),["playedstation"]}throw"Unsupported fetching URI type: "+t.type}(t).then(e=>M(R(e),t)).catch(e=>Spicetify.showNotification(e))}var O=t=>{[document.querySelector(".main-nowPlayingBar-left"),document.querySelector(".player-controls__buttons")].forEach(e=>{e&&(e.style.opacity=t?"1":"0",e.style.pointerEvents=t?"auto":"none")});const e=document.querySelector(".playback-bar");e&&(e.style.pointerEvents=t?"auto":"none")},x=e=>{let t=e.trim().toLowerCase();return t=(t=t.replace(/\(.*\)/g,"")).replace(/[^a-zA-Z0-9]/g,"")},j=class{constructor(){this.DEBOUNCE_TIME=300,this.end=1,this.debouncing=0,this.listener=e=>{if(this.end){if(this.debouncing)return console.debug("debouncing"),void(e.timeStamp-this.debouncing>this.DEBOUNCE_TIME&&(this.debouncing=0,console.debug("reset debouncing")));this.debouncing=e.timeStamp;var e=1e3*this.end,t=Spicetify.Player.getDuration();t<e||e<t*Spicetify.Player.getProgressPercent()&&(Spicetify.Player.pause(),Spicetify.Player.skipBack())}}}setEnd(e){this.end=e}listen(){Spicetify.Player.addEventListener("onprogress",this.listener)}unlisten(){Spicetify.Player.removeEventListener("onprogress",this.listener)}play(){try{Spicetify.Player.pause()}catch(e){console.error(e)}Spicetify.Player.skipBack(),Spicetify.Player.play()}},G=class extends _.default.Component{constructor(e){super(e),this.state={stage:0,guess:"",guesses:[],gameState:0},this.timeAllowed=()=>1+.5*(this.state.stage+this.state.stage**2),this.playClick=()=>{this.audioManager.play()},this.guessChange=e=>this.setState({guess:e.target.value}),this.skipGuess=e=>{e.preventDefault(),this.setState({guesses:[...this.state.guesses,null],guess:"",stage:this.state.stage+1},()=>{this.audioManager.setEnd(this.timeAllowed())})},this.submitGuess=e=>{if(e.preventDefault(),0!==this.state.guess.trim().length){e=this.state.guess,console.log({guess:e}),console.log("title: "+Spicetify.Player.data.track.metadata.title),console.log("artist_name: "+Spicetify.Player.data.track.metadata.artist_name),console.log("album_artist_name: "+Spicetify.Player.data.track.metadata.album_artist_name);const t=x(e)===x(Spicetify.Player.data.track.metadata.title);this.setState({guesses:[...this.state.guesses,this.state.guess],guess:"",stage:this.state.stage+1,gameState:t?1:0},()=>{t?(this.audioManager.setEnd(0),Spicetify.Player.seek(0),Spicetify.Player.play(),O(!0)):this.audioManager.setEnd(this.timeAllowed())})}},this.giveUp=()=>{this.audioManager.setEnd(0),Spicetify.Player.seek(0),Spicetify.Player.play(),O(!0),this.setState({gameState:2})},this.nextSong=()=>{O(!1),Spicetify.Player.next(),Spicetify.Player.seek(0),Spicetify.Player.pause(),this.audioManager.setEnd(1),this.setState({guesses:[],guess:"",stage:0,gameState:0},()=>{this.audioManager.setEnd(this.timeAllowed())})},this.URIs=Spicetify.Platform.History.location.state.URIs,this.audioManager=new j}componentDidMount(){console.log("App mounted, URIs: ",this.URIs);var e=this.URIs;if(e)if(1===e.length)B(e[0]);else{M(R(e),null);try{Spicetify.Player.pause()}catch(e){console.log("Error pausing player:",e)}Spicetify.Player.seek(0)}this.audioManager.listen()}componentWillUnmount(){this.audioManager.unlisten()}render(){const a=1===this.state.gameState;var e=0===this.state.gameState;return _.default.createElement(_.default.Fragment,null,_.default.createElement("div",{className:f},_.default.createElement("h1",{className:d},"ðŸŽµ Name That Tune"),a?_.default.createElement("h2",{className:m},"You won!"):null,_.default.createElement("form",{onSubmit:this.submitGuess},_.default.createElement("input",{type:"text",className:h,placeholder:"Guess the song",value:this.state.guess,disabled:!e,onChange:this.guessChange}),_.default.createElement("div",{className:S},_.default.createElement(D,{onClick:this.submitGuess,disabled:!e},"Guess"),_.default.createElement(D,{onClick:this.skipGuess,disabled:!e},"Skip"))),e?_.default.createElement(D,{onClick:this.playClick},`Play ${this.timeAllowed()}s`):null,_.default.createElement(D,{onClick:e?this.giveUp:this.nextSong},e?"Give up":"Next song"),_.default.createElement("ol",{className:g},this.state.guesses.map((e,t)=>_.default.createElement(b,{key:t,index:t,guesses:this.state.guesses,won:a})))))}},F=a(t("react"));return a=u,c(r({},"__esModule",{value:!0}),a)})();const render=()=>nameDthatDtune.default();